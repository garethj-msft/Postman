{
  "variables": [],
  "info": {
    "name": "EduInitiateAuth",
    "_postman_id": "e3569315-f70e-3e66-2563-64cddfce6691",
    "description": "Get the initial token to bootstrap the auth process.",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "_postman_id": "8afa96ad-51a2-3868-5559-4aa7fc80336b",
      "name": "T_InitiateToken",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "tests[\"Successful Request\"] = responseCode.code === 200;",
              "if(responseCode.code === 200)",
              "{",
              "    var data = JSON.parse(responseBody);",
              "    postman.setGlobalVariable(\"GraphAuth\", \"Bearer \" + data.access_token);",
              "    postman.setGlobalVariable(\"GraphRefresh\", data.refresh_token);",
              "    tests[\"New tokens written to global\"] = true;",
              "}"
            ]
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "GlobalFunctions = {\r",
              "setupMetadataLevel: function(iteration, postman) {\r",
              "if (iteration % 3 === 0)\r",
              "{\r",
              "  postman.setGlobalVariable(\"MetadataLevel\", \"none\");\r",
              "  console.log(\"Metadata = none\");\r",
              "}\r",
              "else if ( iteration % 3 === 1)\r",
              "{\r",
              "  postman.setGlobalVariable(\"MetadataLevel\", \"minimal\");\r",
              "  console.log(\"Metadata = minimal\");\r",
              "}\r",
              "else if ( iteration % 3 === 2)\r",
              "{\r",
              "  postman.setGlobalVariable(\"MetadataLevel\", \"full\");\r",
              "  console.log(\"Metadata = full\");\r",
              "}\r",
              "\r",
              "}\r",
              "}"
            ]
          }
        }
      ],
      "request": {
        "url": "http://{{host}}/versions",
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer eyJ0eXAiOiJKV1QiLCJub25jZSI6IkFRQUJBQUFBQUFEMmRSYjlyZ1Z3VHF3Tk9CbkNnRFFvZ25DTjVXNDVPZ0dRRktQNG53eDNGOHkyRjZNcnNvbE5uR0k5dlhjVVpaUnVleWxQbzV4T28xWU91cVcta1NWT3Zfd0JsRmctUlgxbjV2ak0zaVJ3R2lBQSIsImFsZyI6IlJTMjU2IiwieDV0IjoiZW03WWM2NHgwclk2M1ZiaXVad3cyYWRVRWRnIiwia2lkIjoiZW03WWM2NHgwclk2M1ZiaXVad3cyYWRVRWRnIn0.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC1wcGUuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MtcHBlLm5ldC85YzE5NTUwZC00MTJmLTQ0NjItYmI5YS1kM2IwYTNhZDljMTMvIiwiaWF0IjoxNDk1NjAxMDMzLCJuYmYiOjE0OTU2MDEwMzMsImV4cCI6MTQ5NTYwNDkzMywiYWNyIjoiMSIsImFpbyI6IkFTUUEyLzhEQUFBQU5qYVMxMzdlVVNNajE3VVdkOW1HTHVETitubkd1TjRQT1g2OHRzZm5pMmc9IiwiYW1yIjpbInB3ZCJdLCJhcHBfZGlzcGxheW5hbWUiOiJUb2RvTGlzdFdlYkFwcF9NVCIsImFwcGlkIjoiZDQzMjliY2ItNjllNy00NmM1LWEwMzQtZTkwODdjMGM4MzYzIiwiYXBwaWRhY3IiOiIxIiwiZmFtaWx5X25hbWUiOiJDb25rbGluIiwiZ2l2ZW5fbmFtZSI6IlNjb3R0IiwiaXBhZGRyIjoiMTMxLjEwNy4xNzQuOTIiLCJuYW1lIjoiU2NvdHQgQ29ua2xpbiIsIm9pZCI6IjFiMTk1OWUxLTdmYjgtNGQ0Mi1hNzg0LTVlZDg2NDBiYjE1ZSIsInBsYXRmIjoiMyIsInB1aWQiOiIxMDAzQkZGRDk2RjgzOTJDIiwic2NwIjoiRGlyZWN0b3J5LkFjY2Vzc0FzVXNlci5BbGwgRGlyZWN0b3J5LlJlYWQuQWxsIERpcmVjdG9yeS5SZWFkV3JpdGUuQWxsIEVkdUFkbWluaXN0cmF0aW9uLlJlYWQgRWR1QWRtaW5pc3RyYXRpb24uUmVhZFdyaXRlIEVkdUFzc2lnbm1lbnRzLlJlYWQgRWR1QXNzaWdubWVudHMuUmVhZEJhc2ljIEVkdUFzc2lnbm1lbnRzLlJlYWRXcml0ZSBFZHVBc3NpZ25tZW50cy5SZWFkV3JpdGVCYXNpYyBFZHVSb3N0ZXIuUmVhZCBFZHVSb3N0ZXIuUmVhZFdyaXRlIGVtYWlsIEZpbGVzLlJlYWRXcml0ZS5BbGwgR3JvdXAuUmVhZC5BbGwgR3JvdXAuUmVhZEJhc2ljLkFsbCBHcm91cC5SZWFkV3JpdGUuQWxsIE1lbWJlci5SZWFkLkhpZGRlbiBvZmZsaW5lX2FjY2VzcyBvcGVuaWQgcHJvZmlsZSBVc2VyLlJlYWQgVXNlci5SZWFkLkFsbCIsInNpZ25pbl9zdGF0ZSI6WyJrbXNpIl0sInN1YiI6Ijczb3RKeHNBLXJCbFphZ1YtVmFRUkhObVVQTkd3MV9sVGFXUVQweVNnQ0EiLCJ0aWQiOiI5YzE5NTUwZC00MTJmLTQ0NjItYmI5YS1kM2IwYTNhZDljMTMiLCJ1bmlxdWVfbmFtZSI6InBvcnRhbGFkbWluQHpzZHBwZTkuY2NzY3RwLm5ldCIsInVwbiI6InBvcnRhbGFkbWluQHpzZHBwZTkuY2NzY3RwLm5ldCIsInV0aSI6InMxYmgtYkR5eUUtTHg3dTN1VmdMQUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbIjYyZTkwMzk0LTY5ZjUtNDIzNy05MTkwLTAxMjE3NzE0NWUxMCJdfQ.kboCkxywfBzNJAvQqVZwAkCb9qu5Yb9GtupJDnkt4PGVS3o7vPGbWit3o8oHUPHpqQ3P4yvHj2vIjz3bUOHbhjqe13izGrmuTtwHxt3W31ImkoOqZp3DyJyZ5UCziL-rbE2fx3NShYyEEmrZyFk0oLodwr4Iw9VF4TDLT0W51PJfPMg4kXteXPzWZ69YA2x4qcfokxLcsVMeJvVi-2PmGhjrzGdIHUYbOXryxPCUn4A7eK6ai_AZa3EnSbho3vk9nYVc2XqaWbuCI41udXQu4_p28UuYHAOIuNtCT0oz-u11_gFjHeTrxRe9Nicl4o662EeQxGEPiTDuUTSwPFJUTA",
            "description": ""
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "grant_type",
              "value": "refresh_token",
              "type": "text"
            },
            {
              "key": "refresh_token",
              "value": "{{GraphRefresh}}",
              "type": "text"
            },
            {
              "key": "client_id",
              "value": "d4329bcb-69e7-46c5-a034-e9087c0c8363",
              "type": "text"
            },
            {
              "key": "client_secret",
              "value": "KWNDfXS5S80H6xFOel3/ZG4cagmJX3jwzM8E+oEx75Y=",
              "type": "text"
            }
          ]
        },
        "description": "Use refreshToken variable to request a new access token for the user in PPE environment."
      },
      "response": []
    },
    {
      "_postman_id": "70a58f3d-98a9-4c9e-f4ef-311b2c291a98",
      "name": "FINAL TEST",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "// The Sole purpose of this FINAL TEST is to reset the environment variable Metadata level to minimal",
              "// Keep it as the last test in any run.",
              "postman.setEnvironmentVariable(\"MetadataLevel\", \"minimal\");",
              "postman.setNextRequest(null);",
              ""
            ]
          }
        }
      ],
      "request": {
        "url": "http://{{host}}/{{graphVersion}}/$metadata",
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "{{GraphAuth}}",
            "description": ""
          }
        ],
        "body": {
          "mode": "raw",
          "raw": ""
        },
        "description": ""
      },
      "response": []
    }
  ]
}